
■AWS Direct Connect(DX)

概要
オンプレミスのデータセンターとAWSのインフラストラクチャを専用線でプライベートに接続するサービス

特徴
・インターネットを介さず、高速で安定した専用のネットワーク接続を提供
・AWSのデータセンターと直接繋がるわけではなく、AWS Directロケーションの中継ポイントを介してAWSと間接的に接続できる
＊AWS Directロケーション：ユーザーとAWS側の相互接続ポイント(所定のデータセンター)
・専用線だから通信は安定する
・AWSのサービス提供範囲はロケーションまで。
・ロケーションからオンプレユーザーまでのネットワークを引くのはAPNパートナー
＊APNパートナー：ユーザーの拠点からロケーションまでの回線やセキュリティをやってくれる業者

流れ
企業のデータセンターのルーター
＞APNパートナーが実施＜ロケーションにおいている企業もしくはパートナーのルーター
＞センター内で配線接続＜同じロケーション内のAWSのルーター
＞仮想インターフェースで接続＜仮想プライベートゲートウェイ→VPC

流れ　DXゲートウェイがある場合
＊この場合、VPC同士の接続はできない
＊仮想プライベートゲートウェイは20個まで
企業のデータセンターのルーター
＞APNパートナーが実施＜ロケーションにおいている企業もしくはパートナーのルーター
＞センター内で配線接続＜同じロケーション内のAWSのルーター
＞仮想インターフェースで接続＜DXゲートウェイ
→DXゲートウェイと同じアカウントの複数の仮想プライベートゲートウェイとそれに紐づくVPC


流れ　さらにトランジットゲートウェイがある場合
＊VPC同士の接続が可能
＊VPCを5000個までアタッチ可能
＊全てのVPC同士を相互ピアリングするようなもの
＊そのため、IP重複しないようにCIDRアサインに注意が必要
企業のデータセンターのルーター
＞APNパートナーが実施＜ロケーションにおいている企業もしくはパートナーのルーター
＞センター内で配線接続＜同じロケーション内のAWSのルーター
＞仮想インターフェースで接続＜DXゲートウェイ→トランジットゲートウェイ→複数のVPC


使用例
大規模なデータ移行時に安定した接続を利用して効率的にデータを転送


■接続
概要
AWS Direct Connectとオンプレミスのネットワークを結ぶ物理的なリンク
流れ　のセンター内で配線接続　の部分

特徴
・データがAWSと直接やり取りされる
・占有型とホスト接続の場合にトランジットゲートウェイが使用可能

使用例
オンプレミス環境からAWSにデータを送信するための接続を確立


■プライベート仮想インターフェイス
概要
Direct Connect接続に必要なネットワーク上の部品のようなもの

特徴
・ロケーションからプライベート仮想GWもしくはDXGW→プライベート仮想GWと通信したいときに使用
・データセンターのサーバからプライベートIPアドレスでVPC内部にアクセスできるようになる


◼️トランジット仮想インターフェース
概要
Direct Connectでトランジットゲートウェイに接続するための仮想インターフェース

特徴
・トランジットゲートウェイを使用したいときは必ず使用
・接続　が共用型の場合、使用できない


◼️BGP(Border Gateway Protcol)
ネットワーク機器同士で経路情報を交換するためのプロトコルの一つ
*AS:ネットワークの一かたまり
*ASN(64512-65534):他のASと番号が被らないように採番される番号(被っていたら経路交換できない)
DXの各種ゲートウェイにはASNが必要となるが、考え方はシンプルでAWS上のASNとオンプレ上のASNが重複しなければいいだけ
ただDX Gatewayより先のAWS側はASNが重複していても良い

■LAG (Link Aggregation Group)
概要
複数のDirect Connect接続をまとめて1つの論理接続として扱う機能
流れ　のセンター内で配線接続　の部分を一本の太い線として扱いたい場合のやつ

特徴
・冗長性の向上
・帯域幅の増加

使用例
複数の接続を使用して高可用性と高パフォーマンスを実現


■Direct Connectゲートウェイ
概要
Direct Connect接続を使用して複数のVPCにアクセスするリソース

特徴
・プライベート仮想インターフェイスと複数の仮想プライベートゲートウェイを接続するもの
・中国リージョンのVPCには接続不可
・異なるリージョンのVPCと接続可能
・CloudFormationからは作成できない

使用例
異なるリージョンにある複数のVPCを統合してアクセス


■仮想プライベートゲートウェイ
概要
VPCとオンプレミスのネットワークを接続するためのAWSリソース

特徴
・VPCにアタッチする(このVPCと同一のアカウント上にある必要がある)
・Direct Connectを使用してプライベート通信を確立

使用例
オンプレミスネットワークからVPC内のリソースにプライベートアクセス


■トランジットゲートウェイ
概要
VPC同士の接続を単一のハブで管理できるサービス
複数のVPCやオンプレミスネットワークを簡素化して接続するサービス

特徴
・ネットワーク管理の効率化とスケーラビリティの向上
・別アカウントの複数のVPCとトランジットゲートウェイをアタッチする場合、RAMでトランジットゲートウェイを共有する必要がある

使用例
複数のVPCを統合して管理するための中心的な接続点を提供


◼️トランジットゲートウェイのアタッチメント
VPCアタッチメント
VPCをトランジットゲートウェイにアタッチするためのアタッチメント

DXGWアタッチメント
DX GWをトランジットゲートウェにアタッチするためのアタッチメント


◼️トランジットゲートウェイにおけるルートテーブル
トランジットゲートウェイから外に向けて出る通信がどこに向けて発信するのかを決めるルールを定義するもの
つまり、以下で固定
宛先：アタッチメントをつける相手のネットワークのCIDRで固定
ターゲット：アタッチメントID(VPCアタッチメント、DXGWアタッチメント)


◼️VPCにおけるルートテーブル
サブネットに関連づけて使用
サブネットから外に出る通信をどこに向けて発信するかを決めるルール
明確なルールほど優先して適用される(CIDR範囲が狭いなど)
例：
10.0.0.0/21 local
0.0.0.0/0 Internet Gateway
この場合、10.0.0.0/21への通信は同じVPC内にとび、それ以外はインターネットに飛ぶ



■ROLLBACK_FAILED
更新ステータスがROLLBACK_FAILEDと表示されたら、ステータスがCOMPLETEになるまで更新ができない
スタックアクションより、「更新ロールバックを続ける」を選択
高度なトラブルシューティングより、問題のあるリソースをスキップするため、チェックを入れる
 
 
■変更セット
変更セットを確認する場合
何が変更されているのかのBef/AftとModified Replacementかどうかを確認する
変更セット確認後は変更セットを削除する
 
 
■ドリフト（論理IDが違うリソースの更新を行う場合にスタック更新に影響あるか否か）
CloudFormationから見たときに何も変更がない(テンプレートとの内容に差異がない)ため、リソースに変更は起きない(変更セットにそのリソースの論理IDは表示されない)
 
 
■Parametersセクション
defaultで定義されたパラメータは最初の一回だけ参照される
→二回目以降変更しても意味がないので、スタック更新画面で変更する必要がある
 
 
■Outputsセクション
ImportValue関数で別スタックのリソースを参照する場合、そのリソースが別スタックのOutputsセクションで出力されていることが必須となる
そのため、エクスポート名はスタック間で一意であるほうが望ましい(エクスポート名が重複している場合、参照時にエラーが返ってくる)
 
 
■論理ID
論理ID は英数字（A-Za-z0-9）とし、テンプレート内で一意である必要有
テンプレートセクション＞Rules＞Resources
 
 
■ROLLBACK_FAILED
更新ステータスがROLLBACK_FAILEDと表示されたら、ステータスがCOMPLETEになるまで更新ができない
スタックアクションより、「更新ロールバックを続ける」を選択
高度なトラブルシューティングより、問題のあるリソースをスキップするため、チェックを入れる
 
 
■変更セット
変更セットを確認する場合
何が変更されているのかのBef/AftとModified Replacementかどうかを確認する
変更セット確認後は変更セットを削除する
 
 
■ドリフト（論理IDが違うリソースの更新を行う場合にスタック更新に影響あるか否か）
CloudFormationから見たときに何も変更がない(テンプレートとの内容に差異がない)ため、リソースに変更は起きない(変更セットにそのリソースの論理IDは表示されない)
 
 
■Parametersセクション
defaultで定義されたパラメータは最初の一回だけ参照される
→二回目以降変更しても意味がないので、スタック更新画面で変更する必要がある
 
 
■Outputsセクション
ImportValue関数で別スタックのリソースを参照する場合、そのリソースが別スタックのOutputsセクションで出力されていることが必須となる
そのため、エクスポート名はスタック間で一意であるほうが望ましい(エクスポート名が重複している場合、参照時にエラーが返ってくる)
 
 
■論理ID
論理ID は英数字（A-Za-z0-9）とし、テンプレート内で一意である必要有
https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/resources-section-structure.html
 
 
■DeletionPolicyを利用したドリフト解消方法
[DeletionPolicy: Retain]の設定でスタック削除の対象から特定のリソースを除外することが可能
1.[DeletionPolicy: Retain]を記述してスタック更新(DeletionPolicy付与)
2.ドリフト発生リソースをコメントアウトしスタック更新
「更新」→「変更セットの表示」
→「変更セットの実行」
(☑すべてのスタックリソースをロールバックする)
(☑削除ポリシーを使用する)
3.該当リソースの記述をアンコメントしドリフト箇所を実機に合わせて変更してからスタック更新
4.[DeletionPolicy: Retain]の記述を削除するかアンコメントしてスタック更新(DeletionPolicy除去)


◼️リソース除外
1.除外したいリソースとそのリソースを参照(Ref等)しているリソースにDeletionPolicy: Retainを付与してスタック更新
2.該当リソース(1.)をコメントアウトしてスタック更新


◼️リソースインポート
1.該当リソースに設定値を合わせてDeletionPolicy: Retainを付与したスタックテンプレートファイルをスタックアクションよりインポート
2.DeletionPolicyを削除してスタック更新(掃除)